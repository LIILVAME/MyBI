# ğŸš€ v0.3.0 - Smart Analytics & Reports

## âœ… FonctionnalitÃ©s implÃ©mentÃ©es

### 1. **Reporting & Export**

#### Export PDF
- âœ… `exportUtils.js` : Fonction `exportToPDF()` avec support de colonnes personnalisÃ©es
- âœ… `exportMonthlyReport()` : GÃ©nÃ©ration de rapport mensuel complet en PDF
- âœ… IntÃ©gration dans `StatsPage.vue` et `ReportsPage.vue`
- âœ… Formatage automatique (devises, dates)

#### Export Excel
- âœ… `exportToExcel()` : Export de tableaux de donnÃ©es en Excel
- âœ… Export des paiements
- âœ… Export des biens
- âœ… Largeurs de colonnes automatiques

#### Page Rapports
- âœ… `ReportsPage.vue` : Interface complÃ¨te pour gÃ©nÃ©rer des rapports
- âœ… SÃ©lection de mois pour rapport mensuel
- âœ… Boutons d'export rapides
- âœ… Section "Rapports rÃ©cents" (prÃªte pour persistance)

---

### 2. **Alertes intelligentes**

#### Store Alerts
- âœ… `alertsStore.js` : DÃ©tection automatique de 4 types d'alertes :
  - **Paiements en retard** (`late_payment`)
  - **Paiements impayÃ©s aprÃ¨s X jours** (`unpaid_after_days`)
  - **Fin de bail approchante** (`upcoming_lease_end`)
  - **Taux d'occupation faible** (`low_occupancy`)

#### Page Alertes
- âœ… `AlertsPage.vue` : Interface de gestion des alertes
- âœ… Affichage par sÃ©vÃ©ritÃ© (high, medium, low)
- âœ… Statistiques des alertes (3 KPIs)
- âœ… Actions : "Voir" et "Marquer comme rÃ©solu"
- âœ… Design colorÃ© par sÃ©vÃ©ritÃ©

#### Edge Functions Supabase
- âœ… `supabase/functions/checkAlerts/index.ts` : Cron job pour vÃ©rification quotidienne
- âœ… DÃ©tection des paiements en retard (> 5 jours)
- âœ… DÃ©tection des fins de bail (< 30 jours)
- âœ… Structure prÃªte pour envoi d'emails

---

### 3. **Dashboard analytique avancÃ©**

#### Comparaison de pÃ©riodes
- âœ… `analyticsStore.fetchPeriodComparison()` : Comparaison entre deux pÃ©riodes
- âœ… Calcul des variations (revenu, paiements, occupation)
- âœ… Structure prÃªte pour graphiques comparatifs

#### Top biens
- âœ… `topProperties` computed : Top 5 des biens les plus rentables
- âœ… Utilisable dans les graphiques et rapports

---

### 4. **Navigation & UI**

#### Nouvelles routes
- âœ… `/rapports` : Page des rapports
- âœ… `/alertes` : Page des alertes

#### Sidebar
- âœ… Items "Rapports" et "Alertes" ajoutÃ©s
- âœ… IcÃ´nes SVG dÃ©diÃ©es

---

## ğŸ“ Structure crÃ©Ã©e

### Nouveaux fichiers

#### Utils
- `src/utils/exportUtils.js`

#### Stores
- `src/stores/reportsStore.js`
- `src/stores/alertsStore.js`

#### Pages
- `src/pages/ReportsPage.vue`
- `src/pages/AlertsPage.vue`

#### Edge Functions
- `supabase/functions/checkAlerts/index.ts`
- `supabase/functions/generateMonthlyReport/index.ts`

### Fichiers modifiÃ©s

#### Stores
- `src/stores/analyticsStore.js` : Ajout de `fetchPeriodComparison()` et `topProperties`

#### Pages
- `src/pages/StatsPage.vue` : Ajout des boutons d'export

#### Router
- `src/router/index.js` : Routes `/rapports` et `/alertes`

#### Sidebar
- `src/components/Sidebar.vue` : Items "Rapports" et "Alertes"

---

## ğŸ”§ DÃ©pendances installÃ©es

- `jspdf` : GÃ©nÃ©ration de PDF
- `jspdf-autotable` : Tableaux dans PDF
- `xlsx` : GÃ©nÃ©ration de fichiers Excel
- `file-saver` : TÃ©lÃ©chargement de fichiers

---

## ğŸš€ DÃ©ploiement des Edge Functions

### DÃ©ployer checkAlerts

```bash
# Depuis le projet root
supabase functions deploy checkAlerts
```

### DÃ©ployer generateMonthlyReport

```bash
supabase functions deploy generateMonthlyReport
```

### Configurer le cron job

Dans Supabase Dashboard > Database > Cron Jobs :

```sql
-- VÃ©rification quotidienne des alertes (tous les jours Ã  9h)
SELECT cron.schedule(
  'check-alerts-daily',
  '0 9 * * *',
  $$
  SELECT net.http_post(
    url:='https://YOUR_PROJECT.supabase.co/functions/v1/checkAlerts',
    headers:='{"Content-Type": "application/json", "Authorization": "Bearer YOUR_ANON_KEY"}'::jsonb
  ) AS request_id;
  $$
);
```

---

## ğŸ“Š Types d'alertes

### 1. Paiements en retard (high)
- DÃ©clenchement : `status = 'late'`
- Message : "Le loyer de Xâ‚¬ est en retard de Y jour(s)"
- Action : Lien vers `/paiements`

### 2. Paiements impayÃ©s (medium/high)
- DÃ©clenchement : `status = 'pending'` ET `due_date < maintenant - 5 jours`
- SÃ©vÃ©ritÃ© : `high` si >= 10 jours, `medium` si 5-9 jours
- Message : "Le paiement de Xâ‚¬ est impayÃ© depuis Y jour(s)"
- Action : Lien vers `/paiements`

### 3. Fin de bail approchante (medium/high)
- DÃ©clenchement : `exit_date` existe ET `exit_date` dans les 30 prochains jours
- SÃ©vÃ©ritÃ© : `high` si <= 7 jours, `medium` si 8-30 jours
- Message : "Le bail de X se termine dans Y jour(s)"
- Action : Lien vers `/locataires`

### 4. Taux d'occupation faible (low)
- DÃ©clenchement : `taux < 50%` ET `nombre de biens >= 3`
- Message : "Votre taux d'occupation est de X%"
- Action : Lien vers `/biens`

---

## ğŸ“ TODO v0.3.0+ (AmÃ©liorations futures)

### Persistance
- [ ] Stocker les alertes rÃ©solues dans Supabase
- [ ] Stocker les rapports gÃ©nÃ©rÃ©s dans Supabase
- [ ] Historique des exports

### Emails
- [ ] IntÃ©grer Supabase Email ou SendGrid
- [ ] Templates d'emails pour les alertes
- [ ] Emails de rapport mensuel automatique

### Automatisation
- [ ] Planification d'exports rÃ©currents
- [ ] Webhooks pour intÃ©grations externes
- [ ] Notifications push (si PWA)

### Analytics avancÃ©es
- [ ] Graphiques comparatifs (pÃ©riodes)
- [ ] Tendances et prÃ©visions
- [ ] Heatmap des paiements
- [ ] Dashboard personnalisable (drag & drop)

### Performance
- [ ] Cache des rapports gÃ©nÃ©rÃ©s
- [ ] Pagination pour grandes listes
- [ ] Lazy loading des graphiques

---

## âœ… RÃ©sultat final

- âœ… SystÃ¨me d'export complet (PDF + Excel)
- âœ… Page Rapports fonctionnelle
- âœ… SystÃ¨me d'alertes automatiques
- âœ… Page Alertes avec UI complÃ¨te
- âœ… Edge Functions Supabase prÃªtes
- âœ… Dashboard analytique enrichi
- âœ… Navigation mise Ã  jour

La version **v0.3.0** est prÃªte avec toutes les fonctionnalitÃ©s de reporting et d'alertes intelligentes.

